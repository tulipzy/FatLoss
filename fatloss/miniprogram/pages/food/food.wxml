<view class="container">
  <!-- 相机/相册选择区域 -->
  <view class="camera-section" bindtap="chooseFoodImage">
    <image class="camera-image" src="/images/camera.jpg" mode="aspectFit"></image>
    <text class="camera-title">拍照/选图识别饮食</text>
    
    <!-- 提示层：灯泡图标+文字说明 -->
    <view class="tip-wrap">
      <view class="tip-bulb">
        <view class="bulb-out"></view>
        <view class="bulb-in"></view>
      </view>
      <text class="tip-text">拍照小提示：请把手和食物一左一右放置（手作为参照物），这样识别更准确哟~</text>
    </view>
  </view>

  <!-- 进度卡片容器 -->
  <view class="progress-card">
    <view class="progress-module">
      <!-- 饮食摄入 -->
      <view class="progress-item">
        <!-- 饮食图标 -->
        <view class="diet-icon">
          <view class="diet-plate"></view>
          <view class="diet-food"></view>
        </view>
        <view class="text-group">
          <text class="title">饮食摄入</text>
          <text class="value">{{dietIntake}} 千卡</text>
        </view>
      </view>

      <!-- 双环进度条 -->
      <view class="progress-circle-wrap">
        <view class="progress-circle outer-circle">
          <view class="progress-circle progress-ring" style="{{progressCircleStyle}}">
            <view class="progress-circle inner-circle">
              <view class="circle-text">
                <text class="remain-title">还可摄入</text>
                <text class="remain-value">{{remainCalorie}}</text>
                <text class="recommend">推荐摄入{{recommendCalorie}}千卡</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 喝水记录模块 -->
  <view class="water-section-new">
    <view class="water-header">
      <text class="water-title">喝水情况</text>
    </view>
    
    <!-- 进度条区域 -->
    <view class="water-progress-container">
      <view class="water-progress-bg">
        <view class="water-progress-bar" style="{{waterProgressBarStyle}}"></view>
      </view>
      <view class="water-progress-info">
        <text class="water-progress-text">{{waterIntake}}/{{recommendWater}}ml</text>
        <text class="water-progress-percent">{{waterProgressRatio.toFixed(0)}}</text>
      </view>
    </view>
    
    <!-- 单个大水杯显示区域 -->
    <view class="water-icon-container">
      <view class="single-water-cup">
        <view class="water-cup-container">
          <view class="water-cup-outline">
            <view class="water-cup-water" style="{{waterCupStyle}}"></view>
            <view class="water-cup-top"></view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 操作区 -->
    <view class="water-actions">
      <picker mode="selector" range="{{waterOptions}}" bindchange="chooseWaterAmount">
        <view class="water-picker">
          <view class="droplet-icon">
            <view class="droplet-shape"></view>
          </view>
          <text>选择饮水量：{{selectedWater}}ml</text>
        </view>
      </picker>
      <button class="water-btn" bindtap="addWater">
        <view class="plus-icon">
          <view class="plus-line plus-horizontal"></view>
          <view class="plus-line plus-vertical"></view>
        </view>
        <text>喝水</text>
      </button>
    </view>
  </view>

  <!-- 今日饮食记录 -->
  <view class="diet-list-section">
    <text class="section-title">今日饮食记录</text>
    <view class="diet-items" wx:if="{{dietList.length > 0}}">
      <view class="diet-item" wx:for="{{formattedDietList}}" wx:key="time" data-index="{{index}}">
        <view class="item-header">
          <text class="item-title">{{item.dishName}}</text>
          <text class="item-calorie">{{item.calorie}}千卡</text>
        </view>
        <text class="item-time">{{item.time}}</text>
        <view class="item-details">
          <text class="item-detail">重量: {{item.weight}}g</text>
          <text class="item-detail">热量: {{item.calorie}}千卡</text>
        </view>
        <view class="delete-btn" bindtap="onDeleteRecord" data-index="{{index}}">删除</view>
      </view>
    </view>
    <view class="empty-list" wx:else>
      <text>暂无饮食记录～</text>
      <text>输入食物关键词后，拍照识别或手动添加</text>
    </view>

    <!-- 饮食报告按钮 -->
    <view class="report-btn-container">
      <button class="diet-report-btn" bindtap="gotoDietReport">饮食报告</button>
    </view>
  </view>
</view>

<!-- 添加食物弹窗 -->
<view class="add-food-modal" wx:if="{{showAddFoodModal}}">
  <view class="add-food-modal-mask" bindtap="onCancelAddFood"></view>
  <view class="add-food-modal-content">
    <view class="modal-title">添加新食物</view>
    
    <!-- 食物名称输入 -->
    <view class="modal-form-item">
      <view class="form-label">食物名称 <text class="required">*</text></view>
      <input 
        class="form-input" 
        placeholder="请输入食物名称" 
        value="{{newFoodName}}" 
        bindinput="onNewFoodNameInput"
      />
    </view>
    
    <!-- 食物重量输入 -->
    <view class="modal-form-item">
      <view class="form-label">食物重量(g) <text class="required">*</text></view>
      <input 
        class="form-input" 
        placeholder="请输入食物重量（如：100）" 
        type="number" 
        value="{{newFoodWeight}}" 
        bindinput="onNewFoodWeightInput"
      />
    </view>
    
    <!-- 每100g热量输入 -->
    <view class="modal-form-item">
      <view class="form-label">每100g热量(kcal) <text class="required">*</text></view>
      <input 
        class="form-input" 
        placeholder="请输入每100g热量（如：100.5）" 
        type="number" 
        value="{{newFoodKcalPer100g}}" 
        bindinput="onNewFoodKcalInput"
      />
    </view>
    
    <!-- 错误提示 -->
    <view class="error-text">{{addFoodError}}</view>
    
    <!-- 操作按钮 -->
    <view class="modal-button-group">
      <button class="cancel-button" bindtap="onCancelAddFood">取消</button>
      <button class="confirm-button" bindtap="onConfirmAddFood">确认添加</button>
    </view>
  </view>
</view>

<!-- 数据库查询前的食物名称输入弹窗 -->
<view class="add-food-modal" wx:if="{{showInputFoodNameModal}}">
  <view class="add-food-modal-mask" bindtap="onCancelInputFoodName"></view>
  <view class="add-food-modal-content">
    <view class="modal-title">输入食物名称</view>
    
    <!-- 食物名称输入 -->
    <view class="modal-form-item">
      <view class="form-label">食物名称 <text class="required">*</text></view>
      <input 
        class="form-input" 
        placeholder="请输入要查询的食物名称（如：苹果、米饭）" 
        value="{{foodNameForDbQuery}}" 
        bindinput="onFoodNameForDbInput"
      />
    </view>
    
    <!-- 错误提示 -->
    <view class="error-text">{{inputFoodNameError}}</view>
    
    <!-- 操作按钮 -->
    <view class="modal-button-group">
      <button class="cancel-button" bindtap="onCancelInputFoodName">取消</button>
      <button class="confirm-button" bindtap="onConfirmInputFoodName">查询数据库</button>
    </view>
  </view>
</view>

<!-- 餐具类型选择弹窗 -->
<view class="add-food-modal" wx:if="{{showDishTypeModal}}">
  <view class="add-food-modal-mask" bindtap="onCancelDishType"></view>
  <view class="add-food-modal-content">
    <view class="modal-title">选择餐具类型</view>
    
    <!-- 餐具选择Picker -->
    <view class="modal-form-item">
      <picker 
        mode="selector" 
        range="{{dishTypeLabels}}"
        bindchange="onDishTypeChange"
        value="{{dishTypePickerValue}}"
      >
        <view class="form-input picker-input">
          {{dishTypeLabels[dishTypePickerValue]}}
        </view>
      </picker>
    </view>
    
    <!-- 操作按钮 -->
    <view class="modal-button-group">
      <button class="cancel-button" bindtap="onCancelDishType">取消</button>
      <button class="confirm-button" bindtap="onConfirmDishType">确认选择</button>
    </view>
  </view>
</view>
