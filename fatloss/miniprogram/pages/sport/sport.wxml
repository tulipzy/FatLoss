
<!-- 今日成就与数据展示模块 -->
<view class="target-card" style="position: relative; left: 28rpx; top: 29rpx">
  <!-- 标题区 -->
  <view class="card-header">
    <text class="card-title">今日成就：</text>
    <text class="card-subtitle">{{modeSubtitles[currentMode]}}</text>
  </view>
  
  <!-- 数据区 -->
  <view class="data-container">
    <view class="data-item">
      <text class="data-label">已消耗</text>
      <text class="data-value">{{caloriesBurned}}</text>
      <text class="data-unit">千卡</text>
    </view>
    
    <view class="data-divider"></view>
    
    <view class="data-item">
      <text class="data-label">训练时长</text>
      <text class="data-value">{{trainingTime}}</text>
      <text class="data-unit">分钟</text>
    </view>
  </view>
  
  <!-- 经验进度 -->
  <view class="progress-container">
    <view class="progress-info">
      <text class="level">Lv.{{level}}</text>
      <text class="role">{{roleName}}</text>
      <text class="exp">{{currentExp}}/{{totalExp}}经验</text>
    </view>
    <view class="progress-bar">
      <view class="progress" style="width: {{(currentExp/totalExp)*100 + '%'}};" wx:if="{{totalExp > 0}}"></view>
    </view>
  </view>
  
  <!-- 组数 -->
  <view class="sets-container">
    <text>完成组数</text>
    <text class="sets-count">{{completedSets}} 组</text>
  </view>
</view>


<!-- 今日训练计划模块 -->
<view class="plan-card" style="position: relative; left: 28rpx; top: 72rpx; width: 639rpx; display: block; box-sizing: border-box">
  <!-- 标题 -->
  <view class="card-header flex-between">
    <text class="card-title">今日训练计划</text>
    <text class="edit-plan-btn" bindtap="openEditPanel">确认/修改计划</text>
  </view>
  
  <!-- 训练项目列表 -->
  <view class="plan-list">
    <block wx:for="{{plans}}" wx:key="id">
      <view class="plan-item" bindtap="changePlanStatus" data-id="{{item.id}}">
        <view class="plan-header">
          <text class="plan-name">{{item.name}}</text>
          <view class="plan-status status-{{item.status === 'completed' ? 'completed' : 'todo'}}" bindtap="changePlanStatus" data-id="{{item.id}}">
            {{item.status === 'completed' ? '已完成' : '待完成'}}
          </view>
        </view>
        <text class="plan-detail">{{item.duration}}分钟·{{item.intensityText}}</text>
        <text class="plan-data">{{item.calories}}千卡  {{item.heart_rate}}次/分钟</text>
      </view>
    </block>
  </view>
  
  <!-- 查看全部 -->
  <view class="view-all" bindtap="showNoMoreDataToast">
    <text>查看全部</text>
  </view>
</view>

<!-- 近三天运动记录模块 -->
<view class="recent-exercises-section" style="position: relative; left: 37rpx; top: 112rpx; width: 639rpx; display: block; box-sizing: border-box">
  <view class="card-header" style="position: relative; left: 0rpx; top: 149rpx">
    <text class="card-title" style="position: relative; left: 22rpx; top: -133rpx">近三天运动记录</text>
  </view>
  
  <view class="recent-exercises-list" wx:if="{{!isLoadingRecentExercises}}">
    <block wx:if="{{recentExercises.length > 0}}">
      <block wx:for="{{recentExercises}}" wx:key="index" wx:for-item="item">
        <view class="recent-exercise-item">
          <text class="exercise-name">{{item.exercise_name}}</text>
          <text class="exercise-time">{{item.spent_time}} 分钟</text>
          <text class="exercise-date">{{item.date}}</text>
        </view>
      </block>
    </block>
    <view class="empty-state" wx:else>
      <text>暂无运动记录</text>
    </view>
  </view>
  
  <view class="loading-state" wx:if="{{isLoadingRecentExercises}}">
    <text>加载中...</text>
  </view>
</view>

<!-- 编辑面板 -->
<view class="edit-panel" wx:if="{{showEditPanel}}" animation="{{panelAnimation}}">
  <view class="panel-header">
    <text class="panel-title">编辑训练计划</text>
    <text class="close-btn" bindtap="closeEditPanel">✕</text>
  </view>
  
  <view class="panel-content">
    <view class="edit-plan-list" wx:if="{{editPlans.length > 0}}">
      <block wx:for="{{editPlans}}" wx:key="id">
        <view class="edit-plan-item" data-index="{{index}}" animation="{{item.animationData}}">
          <view class="edit-plan-info">
            <text class="edit-plan-name">{{item.name}}</text>
            <text class="edit-plan-detail">{{item.duration}}分钟·{{item.intensityText}}</text>
          </view>
          <text class="delete-btn" bindtap="confirmDelete" data-index="{{index}}">❌</text>
        </view>
      </block>
    </view>
    
    <view class="empty-tip" wx:else>
      <text>点击+添加首个训练项目</text>
    </view>
  </view>
  
  <view class="add-btn" bindtap="openAddForm">+ 添加新训练项目</view>
  
  <view class="panel-footer">
    <button class="cancel-btn" bindtap="cancelEdit">取消</button>
    <button class="save-btn" bindtap="saveEdit">保存</button>
  </view>
</view>

<!-- 添加项目表单 -->
<view class="add-form" wx:if="{{showAddForm}}" animation="{{formAnimation}}">
  <view class="form-header">
    <text class="form-title">添加训练项目</text>
    <text class="close-btn" bindtap="closeAddForm">✕</text>
  </view>
  
  <view class="form-content">
    <view class="form-item">
      <text class="form-label">训练名称</text>
      <input class="form-input" placeholder="请输入训练名称" bindinput="onNameInput" value="{{newPlan.name}}" />
    </view>
    
    <view class="form-item">
      <text class="form-label">时长</text>
      <input class="form-input" type="number" placeholder="请输入分钟数" bindinput="onDurationInput" value="{{newPlan.duration}}" />
    </view>
    
    <view class="form-item">
      <text class="form-label">强度</text>
      <picker bindchange="onIntensityChange" value="{{intensityIndex}}" range="{{intensityOptions}}">
        <view class="picker">
          {{intensityOptions[intensityIndex]}}
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="form-label">预估消耗</text>
      <input class="form-input" type="number" placeholder="请输入千卡数" bindinput="onCaloriesInput" value="{{newPlan.calories}}" />
    </view>
    
    <view class="form-item">
      <text class="form-label">心率范围</text>
      <input class="form-input" placeholder="如: 120-130" bindinput="onHeartRateInput" value="{{newPlan.heart_rate}}" />
    </view>
  </view>
  
  <view class="form-footer">
    <button class="confirm-add-btn" bindtap="confirmAdd">确认添加</button>
  </view>
</view>

<!-- 遮罩层 -->
<view class="mask" wx:if="{{showEditPanel || showAddForm}}" bindtap="closeAllPanels"></view>

<!-- 加载状态 -->
<view class="loading-mask" wx:if="{{isLoading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载运动推荐...</text>
  </view>
</view>

<!-- 错误提示 -->
<view class="error-message" wx:if="{{errorMsg}}">
  <text>{{errorMsg}}</text>
  <button bindtap="getExerciseRecommendations" size="mini">重试</button>
</view>


<!-- 将图片移到页面末尾并添加固定容器 -->
<view class="fixed-bottom-right-image">
  <image 
    src="../../images/运动记录.jpg" 
    class="sports-record-image" 
    mode="aspectFill" 
    bindtap="toggleImageDisplay"
  ></image>
  <!-- 添加灰色文字 -->
  <text class="sports-record-text">点击记录运动哦~</text>
</view>

<!-- 运动记录新视图 -->
<view class="sports-record-view" wx:if="{{showSportsRecordView}}">
  <!-- 视图标题 -->
  <view class="record-view-header">
    <text class="record-view-title">运动记录</text>
    <text class="record-view-close" bindtap="toggleImageDisplay">×</text>
  </view>
  
  <!-- 视图内容 -->
  <view class="record-view-content">
    <!-- 添加搜索框 -->
    <view class="search-container">
      <view class="search-box">
        <icon class="search-icon" type="search" size="24" color="#999"/>
        <input type="text" class="search-input" placeholder="搜索运动名称" placeholder-style="color:#999" bindinput="onSearchInput"/>
      </view>
    </view>
    
    <!-- 训练模式选择模块 -->
    <view class="training-mode-container">
      <view class="mode-title">选择训练模式</view>
      <view class="mode-options">
        <view class="mode-item {{currentMode === 'home' ? 'active' : ''}}" bindtap="selectMode" data-mode="home">
          <text class="mode-name">居家减脂</text>
        </view>
        <view class="mode-item {{currentMode === 'outdoor' ? 'active' : ''}}" bindtap="selectMode" data-mode="outdoor">
          <text class="mode-name">户外训练</text>
        </view>
        <view class="mode-item {{currentMode === 'gym' ? 'active' : ''}}" bindtap="selectMode" data-mode="gym">
          <text class="mode-name">健身房</text>
        </view>
      </view>
    </view>
    
    <!-- 三种模式下的运动推荐区域 -->
    <view class="recommendations-section" wx:if="{{recommendations && !isLoading && !errorMsg}}">
      <view class="section-title">运动推荐</view>
      
      <!-- 居家运动推荐 -->
      <view class="recommendation-card" wx:if="{{currentMode === 'home'}}">
        <view class="card-header">
          <text class="card-title" style="color: #4CAF50;">居家运动</text>
          <text class="card-subtitle">适合在家进行的高效训练</text>
        </view>
        <view class="recommendation-list">
          <block wx:for="{{recommendations['居家']}}" wx:key="exercise_id" wx:for-item="item">
            <view class="recommendation-item">
              <text class="exercise-name">{{item.exercise_name}}</text>
              <view class="exercise-meta">
                <text class="meta-item">每10分钟消耗: {{item.calories_burned_per_ten_minutes}}千卡</text>
                <text class="meta-item">{{item.reps_or_duration}} × {{item.sets}}组</text>
              </view>
              <button class="add-to-plan-btn" size="mini" bindtap="showTimeInputDialog" data-exercise="{{item.exercise_name}}" data-calories-per-ten="{{item.calories_burned_per_ten_minutes}}" style="color: #7ebaeb;">
                添加到运动记录
              </button>
            </view>
          </block>
        </view>
      </view>
      
      <!-- 户外运动推荐 -->
      <view class="recommendation-card" wx:if="{{currentMode === 'outdoor'}}">
        <view class="card-header">
          <text class="card-title" style="color: #2196F3;">户外运动</text>
          <text class="card-subtitle">享受大自然的同时燃烧卡路里</text>
        </view>
        <view class="recommendation-list">
          <block wx:for="{{recommendations['户外']}}" wx:key="exercise_id" wx:for-item="item">
            <view class="recommendation-item">
              <text class="exercise-name">{{item.exercise_name}}</text>
              <view class="exercise-meta">
                <text class="meta-item">每10分钟消耗: {{item.calories_burned_per_ten_minutes}}千卡</text>
                <text class="meta-item">{{item.reps_or_duration}} × {{item.sets}}组</text>
              </view>
              <button class="add-to-plan-btn" size="mini" bindtap="showTimeInputDialog" data-exercise="{{item.exercise_name}}" data-calories-per-ten="{{item.calories_burned_per_ten_minutes}}" style="color: #2196F3;">
                添加到运动记录
              </button>
            </view>
          </block>
        </view>
      </view>
      
      <!-- 健身房运动推荐 -->
      <view class="recommendation-card" wx:if="{{currentMode === 'gym'}}">
        <view class="card-header">
          <text class="card-title" style="color: #FF9800;">健身房运动</text>
          <text class="card-subtitle">专业器械助力，塑造完美身材</text>
        </view>
        <view class="recommendation-list">
          <block wx:for="{{recommendations['健身房']}}" wx:key="exercise_id" wx:for-item="item">
            <view class="recommendation-item">
              <text class="exercise-name">{{item.exercise_name}}</text>
              <view class="exercise-meta">
                <text class="meta-item">每10分钟消耗: {{item.calories_burned_per_ten_minutes}}千卡</text>
                <text class="meta-item">{{item.reps_or_duration}} × {{item.sets}}组</text>
              </view>
              <button class="add-to-plan-btn" size="mini" bindtap="showTimeInputDialog" data-exercise="{{item.exercise_name}}" data-calories-per-ten="{{item.calories_burned_per_ten_minutes}}" style="color: #2196F3;">
                添加到运动记录
              </button>
            </view>
          </block>
        </view>
      </view>
    </view>
    
    <!-- 这里可以根据需求添加其他运动记录内容 -->
  </view>
</view>
    